\section{Evaluation Metrics}

CacheMedic++ reports both task robustness and stability metrics as primary outputs.

\subsection{Task robustness score and robustness AUC}
We evaluate three tasks: Wikitext-2 perplexity (WT2 PPL), SST-2 prompted classification (accuracy), and a deterministic needle-style long-context probe (accuracy).
To aggregate heterogeneous tasks into a single robustness score, we map each task metric to a \emph{score} $s \in [0,1]$:
for WT2 we use $s_{\mathrm{WT2}} = 1/\mathrm{PPL}$, and for SST-2 and needle we use accuracy.
The overall score is the mean across tasks:
\[
  \mathrm{Score}(\varepsilon) = \frac{1}{|\mathcal{T}|}\sum_{\tau\in\mathcal{T}} s_\tau(\varepsilon).
\]

For a fixed corruption type and a grid of severities $\{\varepsilon_0,\dots,\varepsilon_n\}$, we produce a \textbf{robustness curve} $\mathrm{Score}(\varepsilon)$.
We summarize it by the trapezoidal area under the curve:
\[
  \mathrm{AUC} = \mathrm{trapz}\big(\mathrm{Score}(\varepsilon), \varepsilon\big).
\]
We report:
(i) \textbf{clean score} $\mathrm{Score}(0)$,
and (ii) \textbf{robustness AUC} over the evaluation severity grid (Table~\ref{tab:main}).

\paragraph{Best heuristic baseline.}
We evaluate four inference-only heuristics from the repository (reset/clear, smoothing, masking/dropout, clipping/renorm).
To avoid cherry-picking, we select \emph{best heuristic} as the heuristic with the highest robustness AUC on the evaluation grid, and report that method alongside no defense and CacheMedic++.

\paragraph{Bootstrap uncertainty for paired replication.}
For paired multi-seed comparisons (Table~\ref{tab:seedrep}), we report percentile bootstrap confidence intervals over seed-level paired statistics.
We resample the seed pairs with replacement ($B=20{,}000$) and compute CIs from the 2.5th and 97.5th percentiles.
We apply this to the robustness AUC gain (contr $-$ no\_contr) and sensitivity ratios at $\delta\in\{1,2\}$.

\subsection{Stability metrics: logit sensitivity and amplification maps}
\paragraph{Logit sensitivity.}
We measure finite-difference logit drift under \emph{cache-state perturbations} at magnitudes $\delta \in \{0,1,2\}$.
Let $S$ denote the clean protected cache state for a prompt, and let $\Delta$ be a random perturbation tensor with the same structure as $S$, scaled by per-layer RMS so that its norm matches the requested $\delta$.
Let $z(\cdot)$ be the next-token logits.
We define sensitivity:
\[
  \mathrm{Sens}(\delta) = \mathbb{E}_{x,\Delta}\big[\|z(S+\Delta)-z(S)\|_2\big],
\]
and the repaired version uses logits after applying $R_\phi$ to $S+\Delta$.
To control cost, we compute $\|\cdot\|_2$ over the top-$k$ logits of $z(S)$ (here $k{=}512$), using 60 prompts and 4 directions per prompt.

\paragraph{Amplification maps.}
We estimate which layer/head pairs amplify KV perturbations into output drift.
For each layer $l$ and head $h$, we inject a perturbation that is nonzero only in $(l,h)$ and measure the median drift normalized by perturbation magnitude:
\[
  \gamma(l,h) = \mathrm{median}_{x,\Delta}\left[\frac{\|z(S+\Delta_{l,h})-z(S)\|_2}{\|\Delta_{l,h}\|_F+\epsilon_0}\right],
\]
where $\epsilon_0$ is a small constant (we use $\epsilon_0=10^{-8}$).
We report $\gamma(l,h)$ for selected layers/heads and visualize differences (Fig.~\ref{fig:amp}).

\begin{figure}[t]
  \centering
  \FigOrBox[width=0.95\linewidth]{figures/figC_logit_sensitivity.png}
  \caption{\textbf{Logit sensitivity curves} on gpt2-medium. In the canonical single-seed pair, contraction lowers sensitivity relative to no\_contr; in five-seed aggregate analysis this effect is not consistently directional. Absolute sensitivity relative to the unmodified baseline remains a limitation in this setting.}
  \label{fig:sens}
\end{figure}

\begin{figure}[t]
  \centering
  \FigOrBox[width=0.95\linewidth]{figures/figD_amplification_map.png}
  \caption{\textbf{Layer/head amplification differences} on gpt2-medium. Shown is $\Delta\gamma(l,h) = \gamma_{\mathrm{CacheMedic++}}(l,h)-\gamma_{\mathrm{no\ defense}}(l,h)$ over layers 8--11 and heads 0--15. In this configuration, amplification increases are concentrated in the protected layers (10--11), aligning with the ``absolute stability'' limitation noted in the main text.}
  \label{fig:amp}
\end{figure}

